#!/usr/bin/env ruby

require 'awesome_print'
require 'date'
require 'colorize'
require 'rodzilla'
require 'mothra'

@config = YAML.load_file 'config.yml'

@bz = Rodzilla::Resource::Bug.new(@config['BZ_URL'], @config['BZ_USER'], @config['BZ_PASSWD'], :json)

def search(keyword)
  half_years_ago = DateTime.now - 180
  results = @bz.search(component: @config['COMPONENT'], product: @config['PRODUCT'], creation_time: half_years_ago, status: @config['STATUS'], summary: keyword)

  if not results['bugs'].empty?
    results['bugs'].each_with_index do |r, i|
      print "[#{r['id']}] ".yellow
      print "[#{r['status']}] ".cyan
      print "#{r['summary']} ".white
      puts "[#{r['last_change_time']}] ".gray
    end
  else
    puts 'Not found.'
  end


end

def create

end

search 'broken'
